# CLAUDE.md

本文件为 Claude Code 处理此项目时提供指导。

## 项目概述

这是一个 Claude Code Skill，用于需求分析。它将模糊、非正式的需求转换为结构化的需求文档，支持两种输出格式：

- **用户故事 (User Story)** - 适合敏捷开发、小功能
- **PRD (产品需求文档)** - 适合新产品、大功能、跨团队协作

## 触发条件

当用户输入包含以下关键词或模式时，应激活此 Skill：

**关键词触发：**

- "需求分析"、"分析需求"、"拆分需求"
- "用户故事"、"user story"
- "PRD"、"产品需求文档"、"需求文档"
- "我需要一个...功能"
- "帮我分析..."、"帮我设计..."
- "这个功能需要..."

**场景触发：**

- 用户描述一个模糊的功能需求
- 用户提供非正式的产品想法
- 用户需要将想法转换为可执行的开发任务
- 用户需要完整的产品规划文档

## Skill 架构

```
requirements-analyst/
├── SKILL.md              # Skill 入口点 (YAML 元数据 + 工作流程)
├── CLAUDE.md             # 本文件 - Claude 指导
└── references/           # 模板和问题库
    ├── USER_STORY_TEMPLATE.md      # 故事格式和 INVEST 标准
    ├── PRD_TEMPLATE.md             # PRD 结构和编写指南
    ├── ACCEPTANCE_CRITERIA.md      # 验收标准编写指南
    └── CLARIFICATION_QUESTIONS.md  # 按类别分类的问题模式
```

## 三层加载模式

- **Layer 1**: YAML frontmatter - 始终加载 (name, description, allowed-tools)
- **Layer 2**: SKILL.md body - Skill 触发时加载
- **Layer 3**: references/*.md - 按需加载

## 关键行为

### 输出格式选择

在澄清需求之前，先询问用户需要的输出格式：

| 选择 PRD 当... | 选择用户故事 当... |
|----------------|-------------------|
| 新产品或新模块 | 迭代开发小功能 |
| 涉及多团队协作 | 团队内部沟通 |
| 需要完整规划文档 | 快速交付需求 |
| 用户明确要求 PRD | 用户明确要求故事 |

### 何时使用 AskUserQuestion

1. 用户角色不明确或模糊
2. 核心功能有多种有效解释
3. 验收标准范围未定义
4. 业务规则缺失

### 何时不提问（改为假设）

1. 标准行业惯例适用
2. 技术实现细节
3. 低影响、易更改的决策
4. 用户明确交由判断

### 输出质量标准

**用户故事：**

- 每个故事必须包含角色、功能、价值
- 每个故事至少 3 条验收标准
- 记录所有假设
- 标注延后到后续阶段的内容

**PRD：**

- 必须包含概述、用户分析、功能需求
- 功能需求需包含优先级
- 非功能需求需量化（如性能指标）
- 开放问题需标注决策人

## 工作流程摘要

1. 接收模糊需求
2. **询问输出格式**（用户故事 / PRD）
3. 识别缺失信息和模糊点
4. 提出针对性澄清问题（每批最多 3-5 个）
5. 生成对应格式的需求文档
6. 与用户确认，提供改进选项

## 常用命令

此 Skill 主要通过对话交互，无需执行脚本。

核心工具：

- `Read` - 读取用户提供的需求文档
- `AskUserQuestion` - 向用户提问澄清需求

## 完整工作流程示例

### 输入

```
用户：我需要一个评论功能
```

### Step 1: 识别缺失信息

分析需求，标记模糊点：

- ❓ 谁可以评论？（所有用户/登录用户/特定角色）
- ❓ 评论什么？（文章/商品/视频）
- ❓ 功能范围？（发布/编辑/删除/回复/点赞）

### Step 2: 使用 AskUserQuestion 提问

```
为了生成完整的用户故事，我需要了解：

1. **评论者**: 谁可以发表评论？
   - A: 所有用户（包括游客）
   - B: 仅登录用户
   - C: 特定角色

2. **评论对象**: 用户评论什么内容？
   - A: 文章/帖子
   - B: 商品
   - C: 其他

3. **功能范围**: MVP 需要哪些功能？
   - A: 仅发布评论
   - B: 发布 + 回复
   - C: 发布 + 回复 + 点赞
```

### Step 3: 根据回答生成用户故事

```markdown
## User Story: 发表评论

**As a** 登录用户
**I want** 在文章下发表评论
**So that** 我可以分享我的观点并与作者互动

### Acceptance Criteria
- [ ] Given 用户已登录，when 在文章页输入评论并提交，then 评论显示在评论列表
- [ ] Given 评论内容为空，when 点击提交，then 显示"请输入评论内容"
- [ ] Given 评论包含敏感词，when 提交，then 提示"评论包含违规内容"

### Notes
- 假设：评论需要审核后才显示（可配置）
- 依赖：敏感词过滤服务
```

### Step 4: 确认并迭代

询问用户是否需要：

- 拆分为更小的故事
- 补充更多验收标准
- 调整优先级

## PRD 输出示例

### 输入

```
用户：帮我写一份消息通知系统的 PRD
```

### 输出格式

```markdown
# 消息通知系统 PRD

## 1. 概述

### 1.1 背景
当前用户无法及时获知系统内的重要事件，导致信息滞后。

### 1.2 目标
- 业务目标：提升用户活跃度 20%
- 用户目标：用户可在 1 分钟内收到重要通知

### 1.3 成功指标
| 指标 | 目标值 |
|------|--------|
| 通知送达率 | > 99% |
| 平均延迟 | < 30秒 |

## 2. 用户分析

### 2.1 目标用户
- 主要用户：平台注册用户
- 使用场景：接收系统通知、互动消息

### 2.2 用户痛点
- 错过重要信息
- 通知过多造成干扰

## 3. 功能需求

### 3.1 功能列表
| 功能 | 优先级 | 说明 |
|------|--------|------|
| 站内消息 | P0 | 系统内消息中心 |
| 推送通知 | P1 | App/浏览器推送 |
| 邮件通知 | P2 | 重要事件邮件提醒 |

### 3.2 用户故事
[包含详细的用户故事...]

## 4. 非功能需求
- 性能：支持 10000 QPS
- 安全：敏感通知需加密

## 5. 开放问题
| 问题 | 决策人 | 状态 |
|------|--------|------|
| 是否支持短信通知 | 产品经理 | 待定 |
```
