# CLAUDE.md

本文件为 Claude Code 处理此项目时提供指导。

## 项目概述

这是一个 Claude Code Skill，用于需求分析。它将模糊、非正式的需求转换为结构化的用户故事和验收标准。

## 触发条件

当用户输入包含以下关键词或模式时，应激活此 Skill：

**关键词触发：**
- "需求分析"、"分析需求"、"拆分需求"
- "用户故事"、"user story"
- "我需要一个...功能"
- "帮我分析..."
- "这个功能需要..."

**场景触发：**
- 用户描述一个模糊的功能需求
- 用户提供非正式的产品想法
- 用户需要将想法转换为可执行的开发任务

## Skill 架构

```
requirements-analyst/
├── SKILL.md              # Skill 入口点 (YAML 元数据 + 工作流程)
├── CLAUDE.md             # 本文件 - Claude 指导
└── references/           # 模板和问题库
    ├── USER_STORY_TEMPLATE.md      # 故事格式和 INVEST 标准
    ├── ACCEPTANCE_CRITERIA.md      # 验收标准编写指南
    └── CLARIFICATION_QUESTIONS.md  # 按类别分类的问题模式
```

## 三层加载模式

- **Layer 1**: YAML frontmatter - 始终加载 (name, description, allowed-tools)
- **Layer 2**: SKILL.md body - Skill 触发时加载
- **Layer 3**: references/*.md - 按需加载

## 关键行为

### 何时使用 AskUserQuestion

1. 用户角色不明确或模糊
2. 核心功能有多种有效解释
3. 验收标准范围未定义
4. 业务规则缺失

### 何时不提问（改为假设）

1. 标准行业惯例适用
2. 技术实现细节
3. 低影响、易更改的决策
4. 用户明确交由判断

### 输出质量标准

- 每个故事必须包含角色、功能、价值
- 每个故事至少 3 条验收标准
- 记录所有假设
- 标注延后到后续阶段的内容

## 工作流程摘要

1. 接收模糊需求
2. 识别缺失信息和模糊点
3. 提出针对性澄清问题（每批最多 3-5 个）
4. 生成格式化用户故事
5. 与用户确认，提供改进选项

## 常用命令

此 Skill 主要通过对话交互，无需执行脚本。

核心工具：
- `Read` - 读取用户提供的需求文档
- `AskUserQuestion` - 向用户提问澄清需求

## 完整工作流程示例

### 输入
```
用户：我需要一个评论功能
```

### Step 1: 识别缺失信息

分析需求，标记模糊点：
- ❓ 谁可以评论？（所有用户/登录用户/特定角色）
- ❓ 评论什么？（文章/商品/视频）
- ❓ 功能范围？（发布/编辑/删除/回复/点赞）

### Step 2: 使用 AskUserQuestion 提问

```
为了生成完整的用户故事，我需要了解：

1. **评论者**: 谁可以发表评论？
   - A: 所有用户（包括游客）
   - B: 仅登录用户
   - C: 特定角色

2. **评论对象**: 用户评论什么内容？
   - A: 文章/帖子
   - B: 商品
   - C: 其他

3. **功能范围**: MVP 需要哪些功能？
   - A: 仅发布评论
   - B: 发布 + 回复
   - C: 发布 + 回复 + 点赞
```

### Step 3: 根据回答生成用户故事

```markdown
## User Story: 发表评论

**As a** 登录用户
**I want** 在文章下发表评论
**So that** 我可以分享我的观点并与作者互动

### Acceptance Criteria
- [ ] Given 用户已登录，when 在文章页输入评论并提交，then 评论显示在评论列表
- [ ] Given 评论内容为空，when 点击提交，then 显示"请输入评论内容"
- [ ] Given 评论包含敏感词，when 提交，then 提示"评论包含违规内容"

### Notes
- 假设：评论需要审核后才显示（可配置）
- 依赖：敏感词过滤服务
```

### Step 4: 确认并迭代

询问用户是否需要：
- 拆分为更小的故事
- 补充更多验收标准
- 调整优先级
